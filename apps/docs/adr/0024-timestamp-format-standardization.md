# 0024 – チャットメッセージ時間表示フォーマットの標準化

## 背景 / Context

チャットアプリケーションにおいて、メッセージの時間表示にフォーマットの不統一が発生していた。具体的には、以下の問題が存在した：

- 秒まで表示される場合（HH:MM:SS）と分まで表示される場合（HH:MM）の混在
- ブラウザロケール設定によってAM/PM表記と24時間表記が混在する可能性
- タイムゾーンが明示的に指定されておらず、ユーザーの端末設定に依存

---

## 決定 / Decision

チャットメッセージの時間表示を「HH:MM」形式（24時間表記、秒なし）の日本時間（JST）で統一する。

---

## 理由 / Rationale

- UI/UXの一貫性向上：全てのメッセージで同じフォーマットを使用
- 可読性の向上：秒表示を削除することで視覚的なノイズを減少
- 地域特性への対応：日本語圏のユーザーに適した24時間表記を採用
- タイムゾーンの統一：日本時間固定により時間の混乱を防止

---

## 実装詳細 / Implementation Notes

### 1. 時間フォーマット関数の統一

```ts
// 修正前
new Date().toLocaleTimeString([], {
  hour: "2-digit",
  minute: "2-digit",
  second: "2-digit",
})

// 修正後
new Date().toLocaleTimeString('ja-JP', {
  hour: "2-digit",
  minute: "2-digit",
  hour12: false,
  timeZone: 'Asia/Tokyo'
})
```

理由:

- `'ja-JP'`ロケールを指定して日本語環境を明示
- `hour12: false`により24時間表記を強制
- `second`オプションを削除して秒表示を除去
- `timeZone: 'Asia/Tokyo'`で日本時間を明示的に指定

### 2. 修正対象箇所

7箇所の時間表示コードを統一的に修正：

- `apps/web/app/page.tsx`: 6箇所
  - 初期メッセージ（line 39-44）
  - 言語エラーメッセージ（line 222-228）
  - 音声認識メッセージ（line 253-259）
  - 音声認識エラーメッセージ（line 274-280）
  - AI応答エラーメッセージ（line 330-336）
  - テキスト入力メッセージ（line 534-540）
- `apps/web/app/api/chat/route.ts`: 1箇所
  - AI応答メッセージ（line 46-51）

---

## 影響 / Consequences

- 既存のメッセージ履歴は変更されず、新規メッセージのみ新フォーマットが適用される
- ブラウザキャッシュにより初期メッセージの変更が即座に反映されない場合がある
- タイムゾーンが固定されるため、海外ユーザーには現地時間が表示されない
- フォーマット変更により既存のテストケース（もしあれば）の修正が必要

---

## 言語的・技術的なポイント

- `toLocaleTimeString`のブラウザサポートは良好で、モダンブラウザで安定動作
- `timeZone`オプションはIntl.DateTimeFormatの仕様に基づく
- TypeScriptの型安全性は保たれ、既存のMessage型との互換性も維持
- React/Next.jsのSSRにおいてもクライアントサイドで実行されるため問題なし

---

## 参考 / References

- 特になし

---